<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ–∫–∞–∑–∞–Ω–∏—è –≤–æ–¥—ã</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: Arial; padding: 15px; }
        input, button { width: 100%; padding: 10px; margin: 5px 0; }
        button { background: #0088cc; color: white; border: none; }
        .error { color: red; }
    </style>
</head>
<body>
    <h2>üìä –ü–æ–∫–∞–∑–∞–Ω–∏—è –≤–æ–¥—ã</h2>
    
    <input type="number" id="apartment" placeholder="–ù–æ–º–µ—Ä –∫–≤–∞—Ä—Ç–∏—Ä—ã" min="1" max="87">
    <input type="number" id="cold" step="0.001" placeholder="–•–æ–ª–æ–¥–Ω–∞—è –≤–æ–¥–∞ (–º¬≥)" min="0">
    <input type="number" id="hot" step="0.001" placeholder="–ì–æ—Ä—è—á–∞—è –≤–æ–¥–∞ (–º¬≥)" min="0">
    <input type="text" id="lastname" placeholder="–§–∞–º–∏–ª–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)">
    
    <button onclick="sendData()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    <div id="error" class="error"></div>

    <script>
        Telegram.WebApp.expand();
        Telegram.WebApp.MainButton.setText("–û–¢–ü–†–ê–í–ò–¢–¨");
        Telegram.WebApp.MainButton.show();
        
        Telegram.WebApp.MainButton.onClick(function() {
            sendData();
        });

        async function sendData() {
            const data = {
                apartment: document.getElementById('apartment').value,
                cold: document.getElementById('cold').value,
                hot: document.getElementById('hot').value,
                lastname: document.getElementById('lastname').value
            };
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è
            if (!data.apartment || !data.cold || !data.hot) {
                Telegram.WebApp.showAlert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è!");
                return;
            }

            Telegram.WebApp.MainButton.showProgress();
            
            try {
                const response = await fetch('https://script.google.com/macros/s/AKfycbyormJzKdrAnnI_t8P7C9NpZKgtxn5dsVc4nO_S9SPgHLn-i0fQjemQwd_UT6o4MZ4H/exec', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (result.status === "success") {
                    Telegram.WebApp.showAlert("‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!", () => {
                        Telegram.WebApp.close();
                    });
                } else {
                    throw new Error(result.message || "–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞");
                }
            } catch (e) {
                Telegram.WebApp.showAlert("‚ùå –û—à–∏–±–∫–∞: " + e.message);
                console.error("–û—à–∏–±–∫–∞:", e);
            } finally {
                Telegram.WebApp.MainButton.hideProgress();
            }
        }
    </script>
</body>
</html>

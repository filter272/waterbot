<script>
  Telegram.WebApp.expand();
  
  async function sendData() {
    const data = {
      apartment: document.getElementById('apartment').value,
      cold: document.getElementById('cold').value,
      hot: document.getElementById('hot').value,
      lastname: document.getElementById('lastname').value || ''
    };

    // –¢–µ—Å—Ç–æ–≤—ã–π –≤—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å
    console.log("–û—Ç–ø—Ä–∞–≤–ª—è–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ:", data);
    
    try {
      const GAS_URL = 'https://script.google.com/macros/s/AKfycbw9s6CIceHhSepbnD6h47jbcIFmUafZAjeMGI5X_4JApHj3Jhe4ldoqU7HnpF2YR6k7/exec';
      
      // 1. –ü–æ–ø—ã—Ç–∫–∞ –ø—Ä—è–º–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
      let response = await fetch(GAS_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });
      
      // 2. –ï—Å–ª–∏ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–æ - –ø—Ä–æ–±—É–µ–º —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏
      if (!response.ok) {
        const PROXY_URL = `https://cors-anywhere.herokuapp.com/${GAS_URL}`;
        response = await fetch(PROXY_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
      }
      
      const result = await response.json();
      console.log("–û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:", result);
      
      Telegram.WebApp.showAlert(result.status === "success" 
        ? "‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!" 
        : "‚ùå –û—à–∏–±–∫–∞: " + result.message);
        
    } catch (e) {
      console.error("–û—à–∏–±–∫–∞:", e);
      Telegram.WebApp.showAlert("üö´ –°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞: " + e.message);
    }
  }
</script>

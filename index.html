<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>–ü–æ–∫–∞–∑–∞–Ω–∏—è –≤–æ–¥—ã</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: Arial; padding: 15px; }
        input, button { width: 100%; padding: 10px; margin: 5px 0; }
        button { background: #0088cc; color: white; border: none; }
        #status { color: red; margin-top: 10px; }
    </style>
</head>
<body>
    <h2>üìä –ü–æ–∫–∞–∑–∞–Ω–∏—è –≤–æ–¥—ã</h2>
    
    <input type="number" id="apartment" placeholder="–ù–æ–º–µ—Ä –∫–≤–∞—Ä—Ç–∏—Ä—ã" min="1" max="87" required>
    <input type="number" id="cold" step="0.001" placeholder="–•–æ–ª–æ–¥–Ω–∞—è –≤–æ–¥–∞ (–º¬≥)" min="0" required>
    <input type="number" id="hot" step="0.001" placeholder="–ì–æ—Ä—è—á–∞—è –≤–æ–¥–∞ (–º¬≥)" min="0" required>
    
    <button onclick="sendData()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    <div id="status"></div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WebApp
        Telegram.WebApp.expand();
        Telegram.WebApp.enableClosingConfirmation();
        
        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ (—Å —Ç—Ä–æ–π–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–æ–π)
        async function sendData() {
            const data = {
                apartment: document.getElementById('apartment').value,
                cold: document.getElementById('cold').value,
                hot: document.getElementById('hot').value
            };
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è
            if (!data.apartment || !data.cold || !data.hot) {
                showStatus("‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!", true);
                return;
            }
            
            showStatus("‚åõ –û—Ç–ø—Ä–∞–≤–∫–∞...");
            
            try {
                // 1. –û—Å–Ω–æ–≤–Ω–æ–π —Å–ø–æ—Å–æ–± - —á–µ—Ä–µ–∑ Telegram API
                Telegram.WebApp.sendData(JSON.stringify(data));
                
                // 2. –†–µ–∑–µ—Ä–≤–Ω—ã–π —Å–ø–æ—Å–æ–± - –ø—Ä—è–º–æ–π fetch
                const GAS_URL = '–íhttps://script.google.com/macros/s/AKfycbyUee2V7iF65yaVbqgrPRDCfwA7yrb_W1fiS7Q8mPpcAA7qG3IoVoozmhHk1s7Mw1rz/exec';
                const response = await fetch(GAS_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                // 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–≤–µ—Ç–∞
                if (!response.ok) throw new Error("–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞");
                
                const result = await response.json();
                showStatus(result.status === "success" 
                    ? "‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã" 
                    : "‚ùå –û—à–∏–±–∫–∞: " + result.message);
                
                Telegram.WebApp.close();
                
            } catch (e) {
                showStatus("üö´ –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: " + e.message, true);
                console.error("–û—à–∏–±–∫–∞:", e);
            }
        }
        
        function showStatus(text, isError = false) {
            const status = document.getElementById('status');
            status.textContent = text;
            status.style.color = isError ? "red" : "green";
        }
    </script>
</body>
</html>
    </script>
</body>
</html>

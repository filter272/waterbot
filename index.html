<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>–ü–æ–∫–∞–∑–∞–Ω–∏—è –≤–æ–¥—ã</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: Arial; padding: 15px; }
        input, button { width: 100%; padding: 10px; margin: 5px 0; }
        button { background: #0088cc; color: white; border: none; }
    </style>
</head>
<body>
    <h2>üìä –ü–æ–∫–∞–∑–∞–Ω–∏—è –≤–æ–¥—ã</h2>
    
    <input type="number" id="apartment" placeholder="–ù–æ–º–µ—Ä –∫–≤–∞—Ä—Ç–∏—Ä—ã" min="1" max="87" required>
    <input type="number" id="cold" step="0.001" placeholder="–•–æ–ª–æ–¥–Ω–∞—è –≤–æ–¥–∞ (–º¬≥)" min="0" required>
    <input type="number" id="hot" step="0.001" placeholder="–ì–æ—Ä—è—á–∞—è –≤–æ–¥–∞ (–º¬≥)" min="0" required>
    <input type="text" id="lastname" placeholder="–§–∞–º–∏–ª–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)">
    
    <button onclick="sendData()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    <div id="status"></div>

    <script>
        Telegram.WebApp.expand();
        
        async function sendData() {
            const data = {
                apartment: document.getElementById('apartment').value,
                cold: document.getElementById('cold').value,
                hot: document.getElementById('hot').value,
                lastname: document.getElementById('lastname').value || ''
            };
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è
            if (!data.apartment || !data.cold || !data.hot) {
                Telegram.WebApp.showAlert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è!");
                return;
            }

            document.getElementById('status').textContent = "–û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö...";
            
            try {
                // 1. –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ Telegram WebApp
                Telegram.WebApp.sendData(JSON.stringify(data));
                
                // 2. –î—É–±–ª–∏—Ä—É—é—â–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞–ø—Ä—è–º—É—é –Ω–∞ GAS
                const GAS_URL = 'https://script.google.com/macros/s/AKfycbzo3kf2xn9178YEIKfOUDnOQupAFSYKVAzfO4p5de6STOl_S3mqH68nh1qpyoD86SSP/exec';
                const response = await fetch(GAS_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                document.getElementById('status').textContent = 
                    result.status === "success" 
                    ? "‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã" 
                    : "‚ùå –û—à–∏–±–∫–∞: " + (result.message || "");
                
                Telegram.WebApp.close();
                
            } catch (e) {
                document.getElementById('status').textContent = "üö´ –û—à–∏–±–∫–∞ —Å–µ—Ç–∏";
                console.error("–û—à–∏–±–∫–∞:", e);
            }
        }
    </script>
</body>
</html>
